name: cliferay
help: "Daily scripts for working with Liferay\n\nYou can run these scripts from any folder:\n  - If you are outside a repository, LIFERAY_HOME will be used.\n  - If you are inside a repository, that repository will be used.\n  \nFor example, every day I open my terminal and type:\n\n  > cliferay morning\n\nand it will work, no matter which folder I am in.\n"
version: 1.0.0
environment_variables:
  - name: DEBUG
    help: Set to true to echo all commands being run
    default: false
dependencies:
  gh:
    command: [gh]
    help: Install from https://cli.github.com
  jq:
    command: [jq]
    help: Install from https://jqlang.github.io/jq
commands:

  # cliferay

  - name: aliases
    help: Print the aliases script
    group: cliferay

  - name: completions
    help: Print the completions script
    group: cliferay

  - name: source-folder
    help: Print the cliferay source folder path
    private: true
    group: cliferay

  - name: data-folder
    help: Print the data folder path
    private: true
    group: cliferay

  - name: update
    help: Update cliferay to the latest version
    group: cliferay

  # Build

  - name: ant
    help: Run ant
    catch_all: true
    group: Build

  - name: build
    help: Run 'ant all'
    group: Build

  - name: gw
    help: Run gradlew
    catch_all: true
    group: Build

  - name: ij
    help: Run liferay-intellij
    group: Build

  - name: morning
    help: Run sync, build, ij, nuke and run
    flags:
      - long: --no-nuke
        help: Skip the nuke step
      - long: --force
        short: -f
        help: Force cleanup by running 'git clean -fdx'
    group: Build

  # Server

  - name: curl
    help: Send HTTP requests to the server
    commands:
      - name: ai
        help: Run a curl command based on a prompt
        environment_variables:
          - name: OPENAI_API_KEY
            help: Your OpenAI API Key
            required: true
        args:
          - name: prompt
            help: The prompt
            required: true
        flags:
          - long: --generate
            short: -g
            help: Output the command instead of running it
        examples:
          - cliferay curl ai "create a sample blog posting"
          - cliferay curl ai "list all object definitions"
      - name: new-instance
        help: Create a new instance
        args:
          - name: host
            help: The virtual host
            default: www.able.com
        examples:
          - cliferay curl new-instance www.able.com
      - name: new-api
        help: Create a new API Builder API
      - name: new-object
        help: Create a new object definition with some entries
      - name: new-site-object
        help: Create a new site scoped object definition with some entries
      - name: batch-import
        help: Import a new object entry with batch
      - name: mcp-developer-prompt
        help: Add a developer prompt to the MCP Server
    group: Server

  - name: db-name
    help: Print the database name
    group: Server
    private: true

  - name: elastic-search
    help: Query the Elasticsearch index
    group: Server

  - name: gogo
    help: Open the Gogo Shell
    examples:
      - cliferay gogo
      - cliferay gogo unsatisfied
      - cliferay gogo jaxrs:check
    catch_all:
      label: Command
      help: Optional Gogo shell command to run
    completions:
      - diag
      - unsatisfied
      - scr:list
      - jaxrs:check
    group: Server

  - name: kill
    help: Kill the server
    group: Server

  - name: nuke
    help: Delete all persisted data
    group: Server

  - name: run
    help: Start the server
    group: Server
    args:
      - name: command
        help: Tomcat command
        required: false

  - name: tomcat-folder
    help: Print the current Tomcat folder path
    group: Server
    private: true

  - name: sql
    help: Run a SQL query against the Liferay database
    args:
      - name: sql
        help: The SQL query to run
        required: true
    examples:
      - cliferay sql "SELECT COUNT(*) FROM User_"
    group: Server

  # Code

  - name: baseline
    help: Run baseline in the current folder
    group: Code

  - name: build-rest
    help: Run buildREST globally
    group: Code
    examples:
      - cliferay build-rest

  - name: changed-modules
    alias: cm
    help: List changed modules
    args:
      - name: folder
        help: The root folder to compare
    flags:
      - long: --branch
        short: -b
        arg: branch
        help: Branch to compare against
    group: Code

  - name: deploy
    alias: d
    help: Deploy the current folder
    group: Code

  - name: home
    help: Print the current Liferay home folder path
    environment_variables:
      - name: LIFERAY_HOME
        help: Path to your main liferay-portal clone
        required: true
    group: Code

  - name: format-source
    alias: sf
    help: Run Source Formatter globally
    group: Code

  - name: owner
    help: Output the owner of a path based on CODEOWNERS
    examples:
      - cliferay owner modules/apps/headless/headless-builder
    args:
      - name: path
        help: The path to check
        default: .
    group: Code

  - name: poshi
    help: Run a Poshi test
    group: Code
    examples:
      - cliferay poshi GeneratePathStructureForEndpoints#CanValidatePathInAPIEndpoint
    args:
      - name: test
        help: The test to run
        required: true

  - name: super-deploy
    alias: sd
    help: Deploy changed modules
    args:
      - name: folder
        help: The root folder to compare
    flags:
      - long: --branch
        short: -b
        arg: branch
        help: Branch to compare against
    group: Code

  # Git

  - name: brian
    help: Forward an existing PR to Brian and close it
    group: Git
    examples:
      - cliferay brian https://github.com/liferay-headless/liferay-portal/pull/1433
    args:
      - name: pr
        help: Link to the GitHub PR
        required: true

  - name: backport
    alias: b
    help: Backport commits to other branches
    args:
      - name: text
        help: Text to filter commits by (e.g., LPD-1234)
        required: true
    flags:
      - long: --branch
        short: -b
        arg: branch
        help: Source branch
    group: Git

  - name: set-ticket
    help: Set the Jira ticket on your local commits
    group: Git
    examples:
      - cliferay set-ticket LPD-XXXX
    args:
      - name: ticket
        help: The ticket reference
        required: true
    flags:
      - long: --branch
        short: -b
        arg: branch
        help: Source branch

  - name: stats
    help: Calculate various Git statistics
    group: Git
    commands:
      - name: users
        help: Get information about users
        commands:
          - name: jira
            help: Show the Jira ID
            args:
              - name: user
                help: The user handle
                required: true
            examples:
              - cliferay stats users jira alejandro.tardin
          - name: emails
            help: Show the user's Git emails
            args:
              - name: user
                help: The user handle
                required: true
            examples:
              - cliferay stats users emails alejandro.tardin
      - name: years
        help: Show commit count per year
        args:
          - name: user
            help: The user
        examples:
          - cliferay stats years alejandro.tardin
      - name: ranking
        help: Show commit ranking
        args:
          - name: emails
            help: The emails of the commit authors
            repeatable: true
        examples:
          - cliferay stats ranking alejandro.tardin@liferay.com
      - name: tickets
        help: Show tickets worked on, based on commits
        args:
          - name: user
            help: The user
        examples:
          - cliferay stats tickets alejandro.tardin
      - name: commits
        help: Print the commits for the user
        args:
          - name: user
            help: The user
        examples:
          - cliferay stats commits alejandro.tardin@liferay.com
      - name: folders
        help: Print the folders changed by the user
        args:
          - name: user
            help: The user
        examples:
          - cliferay stats folders alejandro.tardin@liferay.com
      - name: review
        help: Write a review based on Git and Jira stats
        args:
          - name: user
            help: The user to be reviewed
        examples:
          - cliferay stats review alejandro.tardin@liferay.com
      - name: assigned
        environment_variables:
          - name: JIRA_API_USER
            help: Your Jira email
            required: true
          - name: JIRA_API_TOKEN
            help: Your Jira API Token (https://id.atlassian.com/manage-profile/security/api-tokens)
            required: true
        help: Show all tickets ever assigned to the user
        args:
          - name: user
            help: The user
        examples:
          - cliferay stats assigned alejandro.tardin
      - name: headless-summary
        help: Show tickets grouped by folder
        args:
          - name: user
            help: The user
            required: true
        examples:
          - cliferay stats headless-summary alejandro.tardin
  - name: sync
    help: Sync fork and local copy with upstream
    group: Git

  - name: tickets
    help: Extract all Jira tickets from the output of 'git log'
    group: Git
    examples:
      - git log | cliferay tickets

  # Jira

  - name: jira
    help: Open a Jira ticket in the browser
    args:
      - name: ticket
        help: The ticket reference (e.g., LPD-1234). If not provided, it will be extracted from the Git branch name.
    group: Jira

  # GTD

  - name: todo
    help: Create a todo in Trello
    environment_variables:
      - name: TRELLO_API_KEY
        help: Your Trello API Key (https://developer.atlassian.com/cloud/trello/guides/rest-api/authorization)
        required: true
      - name: TRELLO_TOKEN
        help: Your Trello Token (https://trello.com/1/authorize?expiration=never&scope=read,write,account&response_type=token&key=TRELLO_API_KEY)
        required: true
      - name: TRELLO_LIST_ID
        help: Your Trello List ID (https://community.atlassian.com/forums/Trello-questions/How-do-I-find-the-LIST-ID/qaq-p/2272862)
        required: true
    catch_all:
      label: title
      help: The todo title
      required: true
    examples:
      - cliferay todo Complete 100% of the milestone
      - cliferay todo Review PR http://github.com/...
    group: GTD

  - name: todos
    help: List todos from Trello
    environment_variables:
      - name: TRELLO_API_KEY
        help: Your Trello API Key (https://developer.atlassian.com/cloud/trello/guides/rest-api/authorization)
        required: true
      - name: TRELLO_TOKEN
        help: Your Trello Token (https://trello.com/1/authorize?expiration=never&scope=read,write,account&response_type=token&key=TRELLO_API_KEY)
        required: true
      - name: TRELLO_LIST_ID
        help: Your Trello List ID (https://community.atlassian.com/forums/Trello-questions/How-do-I-find-the-LIST-ID/qaq-p/2272862)
        required: true
    examples:
      - cliferay todos
    group: GTD
